####################################################################################################
#
# unit sytem: GPa / mm / ms
#
####################################################################################################

####################################################################################################
# MATERIAL PARAMETERS
####################################################################################################
variable        rho equal 1000 # mass density water
variable        c0 equal 63.0 # speed of sound for water
variable        K equal  ${c0}*${c0}*${rho} # Young's modulus for solid objects
variable        nu equal 0.3 # Poisson ratio for solid objects
variable        G equal 3*${K}*(1-2*${nu})/(2*(1+${nu}))
variable        sigma_yield equal 1.1*${G} # plastic yield stress for solid objects
variable        hardening_parameter equal 0 # plastic hardening parameter for solid objects
variable        contact_stiffness equal 10*${K} # contact force amplitude
variable        q1 equal 0.06 # artificial viscosity
variable        q2 equal 0.0 # artificial viscosity
variable        Hg equal 10 # Hourglass control coefficient for solid objects
variable        Cp equal 1.0 # heat capacity -- not used here
variable        contact_scale equal 2.0 # scale factor to increase contact gap between bodies

####################################################################################################
# INITIALIZE LAMMPS
####################################################################################################
units		si
dimension       2
boundary        f f p
atom_style      smd
neigh_modify    every 5 delay 0 check yes
comm_modify     vel yes cutoff 0.1
newton          off
atom_modify     map hash
comm_style      tiled

####################################################################################################
# CREATE SIMULATION BOX
####################################################################################################
variable        l0 equal 1.0 # initial particle lattice spacing
region          box block 0 100 0 100 -0.1 0.1 units box
create_box      1 box

####################################################################################################
# DEFINE BOUNDARY CONDITIONS
#
####################################################################################################

####################################################################################################
# CREATE PARTICLES
####################################################################################################
lattice         sq ${l0}
create_atoms    1 box
displace_atoms  all random 0.02 0 0 220578 units box
region          left block EDGE 5 EDGE EDGE EDGE EDGE units box
region          rght block 5.5 EDGE EDGE EDGE EDGE EDGE units box
group           left region left
group           rght region rght
region          center block 40 60 40 60 EDGE EDGE side in
group           center region center

####################################################################################################
# DISCRETIZATION PARAMETERS
####################################################################################################
variable        h equal 2.5*${l0} # SPH kernel diameter
variable        vol_one equal ${l0}^2 # initial particle volume for 2d simulation
variable        contact_radius equal ${l0}/2
set             group all diameter ${h}
set             group all smd_contact_radius ${contact_radius}
set             group all volume  ${vol_one}
set             group all smd_mass_density ${rho}
#set             group left smd_heat 10.0
#set             group rght smd_heat 0.0
set             group all smd_heat 1.0
set             group center smd_heat 100.0
variable        skin equal ${h} # Verlet list range
neighbor        ${skin} bin
variable        mpm_cellsize equal 1.0*${l0}

####################################################################################################
# INTERACTION PHYSICS / MATERIAL MODEL
# 3 different pair styles are used:
#     - updated Lagrangian SPH for water
#     - total Lagrangian SPH for solid objects
#     - a repulsive Hertzian potential for contact forces between different physical bodies
####################################################################################################
pair_style      smd/mpm_linear ${mpm_cellsize} FLIP 1
pair_coeff      1 1 *COMMON ${rho} ${c0} ${q1} ${Cp} ${Hg} &
                              *EOS_TAIT 2 &
                              *VISCOSITY_NEWTON 0.0 &
			      *HEAT_CONDUCTION 1.0 &
	                      *END

####################################################################################################
# TIME INTEGRATION
####################################################################################################
fix             dtfix all smd/adjust_dt 0.5 # dynamically adjust time increment every step
#fix             integration_fix_water all smd/integrate_mpm FLIP 1

####################################################################################################
# SPECIFY TRAJECTORY OUTPUT
####################################################################################################
compute         eint all smd/internal_energy
compute         contact_radius all smd/contact_radius
compute         vol all smd/volume
compute         rho all smd/rho
compute         peatom all pe/atom
compute         S all smd/ulsph_stress
compute         D all smd/ulsph_strain_rate
compute         q all smd/heat

dump            dump_id all custom 10 dump.LAMMPS id type x y &
                fx fy vx vy c_eint c_contact_radius mol &
                radius c_vol c_rho proc c_peatom c_S[1] c_S[2] c_S[4] c_D[1] c_D[2] c_D[4] c_q
dump_modify     dump_id first yes


####################################################################################################
# STATUS OUTPUT
####################################################################################################
compute         alleint all reduce sum c_eint
compute         allq all reduce sum c_q
variable        etot equal pe+ke+c_alleint # total energy of the system
thermo          1
thermo_style    custom step ke pe v_etot c_alleint f_dtfix dt c_vol c_allq
thermo_modify   lost ignore

####################################################################################################
# RUN SIMULATION
####################################################################################################
run             1
#fix             balance_fix all balance 1000 0.9 rcb # load balancing for MPI
fix             2 all enforce2d

#run 400
#dump_modify     dump_id every 1

run 1000
#
